<section class="p-4 lg:p-8 max-w-7xl mx-auto space-y-16">

  @if (upcomingLoading() || competitionLoading()) {
    <div class="space-y-8">
      <div class="skeleton h-[400px] w-full rounded-3xl"></div>
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        <div class="skeleton h-48 w-full rounded-2xl"></div>
        <div class="skeleton h-48 w-full rounded-2xl"></div>
        <div class="skeleton h-48 w-full rounded-2xl"></div>
      </div>
    </div>
  } @else if (error()) {
    <div role="alert" class="alert alert-error shadow-lg rounded-xl">
      <svg xmlns="http://www.w3.org/2000/svg"
           class="stroke-current shrink-0 h-6 w-6"
           fill="none"
           viewBox="0 0 24 24">
        <path stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span class="font-medium">
        {{ error() || ('HOME.ERROR.GENERIC' | translate) }}
      </span>
    </div>
  } @else {


    <div class="relative w-full overflow-hidden rounded-3xl bg-gradient-to-br from-primary via-primary/80 to-black p-8 md:p-12 shadow-2xl group border border-white/5">
      <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-8">
        <div class="space-y-2 text-center md:text-left">
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 text-white/80 text-xs font-bold uppercase tracking-widest mb-2 border border-white/10">
            Saison 2026
          </div>
          <h2 class="text-4xl md:text-6xl font-black text-white uppercase italic tracking-tighter leading-none">
            Racepass
          </h2>
          <p class="text-white/90 font-medium text-lg">
            Rejoins la 1ère course du tour, le mardi 17 février et tente de remporter le classement général de ta catégorie !
          </p>
        </div>
        <a 
          [routerLink]="['/zw/racepass/236/348']" 
          target="_blank"
          class="btn btn-lg btn-primary border-none hover:bg-primary/90 px-12 shadow-xl transition-transform group-hover:scale-105">
          S'inscrire
        </a>
      </div>
    </div>

    <!-- ====================================================== -->
    <!-- UPCOMING / HERO EVENT -->
    <!-- ====================================================== -->
    @if (upcoming().length > 0; as hasUpcoming) {
      @let c = upcoming()[0];

      <div class="space-y-4">
        <h2 class="text-3xl font-black tracking-tight text-base-content uppercase italic px-1">
          <!-- <span class="text-primary">ZWIFT</span> -->
          {{ 'HOME.HERO.TITLE' | translate }}
        </h2>

        <div class="relative w-full aspect-[4/3] md:aspect-[16/9] xl:aspect-[21/9] rounded-3xl shadow-2xl overflow-hidden group border border-base-content/5">
          <img src="/images/worlds/France009.jpg"
               [alt]="c.competitionName"
               class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105">

          <div class="absolute bottom-0 left-0 right-0 p-6 lg:p-10 flex flex-col justify-end">
            <div class="flex flex-wrap gap-2 mb-4">
              <span class="badge badge-primary font-bold border-none shadow-lg shadow-primary/30">
                {{ c.typeCompetition }}
              </span>
            </div>
            <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 md:gap-6">
              <div class="space-y-2 min-w-0">
                <h3
                  class="text-2xl sm:text-3xl md:text-4xl xl:text-6xl
                        font-black text-white leading-[0.95] drop-shadow-xl uppercase italic
                        break-words">
                  {{ c.competitionName }}
                </h3>

                <div class="flex items-center gap-2 text-white/90 font-medium text-base sm:text-lg md:text-xl">
                  <!-- icon -->
                  {{ c.fromDate | date: 'EEEE, d MMMM' }} - {{ c.toDate | date: 'EEEE, d MMMM' }}
                </div>
              </div>

              <a
                class="btn btn-primary btn-md md:btn-lg border-none shadow-xl shadow-primary/20
                      w-full md:w-auto"
                [routerLink]="['/game/competition', c.competitionId]">
                {{ 'HOME.HERO.STAGES_DETAILS' | translate }}
              </a>
            </div>
          </div>
        </div>
      </div>
    }

    <!-- ====================================================== -->
    <!-- CURRENT LEADERS -->
    <!-- ====================================================== -->
    @if (categories().length > 0) {
      
      <div class="space-y-6">

        <div class="flex items-end justify-between px-1 border-b border-base-content/10 pb-4">
          <h2 class="text-3xl font-black tracking-tight uppercase italic">
            <span class="text-primary">
              {{ 'HOME.CURRENT.TITLE' | translate }}
            </span>
          </h2>

          <a
            class="btn btn-ghost btn-sm"
            [routerLink]="['/game/competition', competition()?.[0]?.competitionId]"
          >
            {{ 'HOME.CURRENT.FULL_STANDINGS' | translate }} →
          </a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">

           @for (cat of categoriesSorted(); track cat.catId) {
            <div class="card bg-base-100 shadow-lg border border-base-200 overflow-hidden hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 group">

              <div class="card-body p-6 flex flex-col items-center">

                <div class="w-full flex justify-between items-start mb-2">
                  <div class="flex items-center gap-3">
                    <div class="flex items-center justify-center w-12 h-12 rounded-xl font-black text-2xl shadow-inner bg-base-200">
                      {{ cat.catId }}
                    </div>
                    <div class="flex flex-col">
                      <span class="text-xs font-bold uppercase opacity-50 tracking-wider">
                        {{ 'HOME.CATEGORY.LABEL' | translate }}
                      </span>
                      <span class="font-bold text-sm">
                        {{ 'HOME.CATEGORY.GC' | translate }}
                      </span>
                    </div>
                  </div>
                </div>

                <div class="relative drop-shadow-xl transform group-hover:scale-110 transition-transform duration-500 ease-out my-4">
                  <app-jersey
                    variant="{{competition()?.[0]?.gcVariant}}"
                    [size]="110"
                    fill="{{competition()?.[0]?.gcFillColor}}"
                    stroke="#000"
                    [strokeWidth]="0.5">
                  </app-jersey>
                </div>

                <div class="w-full flex flex-col items-center space-y-2 mt-2">
                  @for (l of cat.leaders; track l.zwiftId) {
                    @if (l.jerseyId === 1) {
                      <a 
                        (click)="goToZwiftPovwer(l.zwiftId)"
                         class="link link-hover text-xl lg:text-2xl font-black truncate max-w-full text-center block">
                        {{ l.racerName }}
                      </a>
                    }
                  }
                </div>

                <div class="mt-auto pt-6 w-full">
                  <a class="btn btn-sm btn-ghost w-full group-hover:bg-base-200"
                     [routerLink]="['/game/competition', competition()?.[0]?.competitionId]">
                    {{ 'HOME.BUTTONS.VIEW_FULL_STANDINGS' | translate }}
                  </a>
                </div>

              </div>
            </div>
          }
        </div>
      </div>
    }
    @else if (categories().length === 0) {

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

    <div class="card bg-base-100 shadow-xl border border-base-300/40 relative overflow-hidden">

      <!-- Glow discret -->
      <div class="absolute -top-10 -right-10 w-32 h-32 rounded-full bg-primary/10 blur-2xl"></div>

      <div class="card-body items-center text-center space-y-4 relative">

        <!-- Jersey GC -->
              <div class="relative drop-shadow-xl transform group-hover:scale-110 transition-transform duration-500 ease-out my-4">
                  <app-jersey
                    variant="{{competition()?.[0]?.gcVariant}}"
                    [size]="110"
                    fill="{{competition()?.[0]?.gcFillColor}}"
                    stroke="#000"
                    [strokeWidth]="0.5">
                  </app-jersey>
                </div>

        <!-- Texte teaser -->
        <div class="space-y-1">
          <h3 class="text-lg font-black uppercase tracking-wide">
            Classement général
          </h3>
          <p class="text-sm text-base-content/60 italic">
            Le classement général individuel sera en jeu dans chacune des 10 catégories
          </p>
        </div>

        <!-- Badge -->
        <div class="badge badge-primary badge-outline">
          départ le 17 février
        </div>

      </div>
    </div>

  </div>

    }
  }
</section>
