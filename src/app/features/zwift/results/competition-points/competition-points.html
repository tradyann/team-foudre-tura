<div class="mb-6">
  <a
    [routerLink]="['/game/competition', competitionId()]"
    class="inline-flex items-center gap-2 text-xs font-semibold uppercase tracking-widest hover:opacity-80 transition"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
    Retour
  </a>
</div>

<div role="tablist" class="tabs tabs-border">
    <a role="tab" class="tab tab-active" (click)="goToPage('/zw/competition-results')">GENERAL RANKING</a>
    <a role="tab" class="tab" (click)="goToPage('/zw/stage-results')">STAGE RANKING</a>
</div>

<div role="tablist" class="tabs tabs-border">
    <a role="tab" class="tab" (click)="goToPage('/zw/stage-results')">TIME Classification</a>
    <a role="tab" class="tab tab-active" (click)="goToPageJersey('/zw/stage-points')">JERSEY Classification</a>
</div>


<div class="p-4">
    @if (loading()) {
        <!-- Skeleton loading -->
        <div class="flex gap-4">
            <div class="skeleton h-24 w-24 rounded"></div>
            <div class="flex-1 space-y-3">
                <div class="skeleton h-6 w-1/3"></div>
                <div class="skeleton h-4 w-1/2"></div>
                <div class="skeleton h-4 w-2/3"></div>
            </div>
        </div>
    } @else if (error()) {
        <div class="text-red-600">{{ error() }}</div>
    } @else {
        <h2 class="text-xl hover:underline hover:text-primary font-bold cursor-pointer" (click)="goToPage('/game/competition')">
            {{ competitionInfos()?.competitionName }}
        </h2>

        <h3 class="mt-1">{{ jerseyInfos()?.jerseyName }}</h3>

        <select
            class="select select-bordered w-full max-w-xs"
            (change)="onSelectIndex($event)"
        >
            @for (jersey of (jerseyInfos() ?? []); track jersey.jerseyId) {
                <option
                    [value]="jersey.jerseyId"
                    [selected]="jersey.jerseyId === jerseyId()"
                >
                    {{ jersey.jerseyName }}
                </option>
            }
        </select>

        @if (results(); as data) {

            @if (stageNumber() > 0 && stageNumber() < data.lastStageNumber) {
                <p class="text-sm opacity-60 mb-2">
                    Rankings after stage {{ stageNumber() }}
                </p>
            }

            <!-- Navigation Stages -->
            <div class="flex gap-2 items-center mb-3">
                @if (stageNumber() === 0 && data.lastStageNumber > 0){
                    <button
                            class="btn btn-ghost btn-sm"
                            (click)="goToStage(1)"
                        >
                            > Rankings after stages
                    </button>
                }
                @if (stageNumber() >= 1){
                    <button
                        class="btn btn-ghost btn-sm"
                        [disabled]="stageNumber() == 1"
                        (click)="goToStage(stageNumber() - 1)"
                    >
                        <
                    </button>
                    <span class="px-2 text-sm">
                        Stage {{ stageNumber() }} / {{ data.lastStageNumber }}
                    </span>

                    <button
                        class="btn btn-ghost btn-sm"
                        [disabled]="stageNumber() >= data.lastStageNumber"
                        (click)="goToStage(stageNumber() + 1)"
                    >
                        >
                    </button>
                }
            </div>

            <!-- Boutons CatÃ©gories -->
            <div class="flex gap-2 mb-4">
                @for (cat of ['A','B','C','D','E']; track cat) {
                    <button
                        class="btn btn-sm"
                        [ngClass]="{'btn-primary': cat === category(),'btn-ghost': cat !== category()}"
                        (click)="goToCategory(cat)"
                    >
                        {{ cat }}
                    </button>
                }
            </div>


            <div class="overflow-auto">
                <table class="table w-full table-zebra border border-base-300">
                    <thead>
                        <tr class="bg-base-200 text-sm">
                            <th>#</th>
                            <th>Rider</th>
                            <th class="text-right">Points</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (data?.results?.length) {
                            @for (rider of data.results; track rider.gcRank; let i = $index) {
                                
                                <!-- Ligne du coureur -->
                                <tr [ngClass]="{ 'opacity-50 italic': rider.isTimeDisabled }">
                                    <td>{{ rider.gcRank }}</td>
                                    <td>
                                        @if (rider.flag) {
                                            <img
                                                class="inline h-4 w-5 me-2"
                                                [src]="'assets/flags/4x3/' + rider.flag + '.svg'"
                                                [attr.alt]="rider.flag"
                                            />
                                        }
                                        <span 
                                            [routerLink]="['/game/rider-details', rider.zwiftId]" 
                                            class="hover:underline hover:text-primary cursor-pointer" [innerHTML]="rider.racerName"></span>
                                    </td>
                                    <td class="text-right">{{ rider.sumTotalPoints }}</td>
                                    <td>{{ rider.slotNumber }}</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        } @else {
            <div class="text-gray-500 mt-4">No results available.</div>
        }
    }
</div>
