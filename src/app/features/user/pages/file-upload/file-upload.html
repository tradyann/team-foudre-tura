<div class="max-w-2xl mx-auto p-4">
  <div class="card bg-base-200">
    <div class="card-body">

      <!-- Title -->
      <h2 class="card-title">
        {{ 'UPLOAD.TITLE' | translate }}
      </h2>

      <!-- Intro -->
      <p
        class="text-sm opacity-80"
        [innerHTML]="'UPLOAD.INTRO' | translate">
      </p>

      <!-- Kind selector -->
      <div class="mt-2 flex flex-wrap gap-2">
        <div class="join">
          <input
            class="join-item btn btn-sm"
            type="radio"
            name="kind"
            aria-label="Video"
            [class.btn-primary]="kind() === 'video'"
            (click)="onKindChange('video', fileInput)"
            [value]="'video'">
          <input
            class="join-item btn btn-sm"
            type="radio"
            name="kind"
            aria-label="FIT"
            [class.btn-primary]="kind() === 'fit'"
            (click)="onKindChange('fit', fileInput)"
            [value]="'fit'">
          <input
            class="join-item btn btn-sm"
            type="radio"
            name="kind"
            aria-label="Image"
            [class.btn-primary]="kind() === 'image'"
            (click)="onKindChange('image', fileInput)"
            [value]="'image'">
          <input
            class="join-item btn btn-sm"
            type="radio"
            name="kind"
            aria-label="Log"
            [class.btn-primary]="kind() === 'log'"
            (click)="onKindChange('log', fileInput)"
            [value]="'log'">
        </div>

        @if (maxLabel()) {
          <span class="badge badge-outline">
            {{ 'UPLOAD.MAX_LABEL' | translate:{ size: maxLabel() } }}
          </span>
        }
      </div>

      <!-- File picker -->
      <label class="form-control w-full mt-3">
        <span class="label">
          <span class="label-text">
            {{ 'UPLOAD.PICK.LABEL' | translate:{ kind: kind() } }}
          </span>
        </span>

        <input
          #fileInput
          type="file"
          class="file-input file-input-bordered w-full"
          [attr.accept]="accept()"
          (change)="onPick($event, fileInput)"
        />

        <span
          class="label-text-alt mt-1"
          [innerHTML]="'UPLOAD.PICK.HELP' | translate">
        </span>
      </label>

      <!-- Selected file summary -->
      @if (selectedFile()) {
        <div class="mt-3 p-3 rounded-box bg-base-100 border border-base-300">
          <div class="flex items-start justify-between gap-3">
            <div class="min-w-0">
              <div class="font-medium truncate">
                {{ selectedFile()?.name }}
              </div>
              <div class="text-xs opacity-70">
                {{ 'UPLOAD.FILE.BYTES' | translate:{ size: selectedFile()?.size ?? 0 } }}
                â€¢
                {{ selectedFile()?.type || ('UPLOAD.FILE.TYPE_FALLBACK' | translate) }}
              </div>
            </div>

            <div class="flex gap-2">
              <button
                class="btn btn-ghost btn-sm"
                (click)="clearSelection(fileInput)">
                {{ 'UPLOAD.FILE.CLEAR' | translate }}
              </button>
            </div>
          </div>
        </div>
      }

      <!-- Controls -->
      <div class="mt-3 flex flex-wrap items-center gap-2">
        <button
          class="btn btn-primary"
          (click)="startUpload(fileInput)"
          [disabled]="!selectedFile() || uploading()">

          @if (uploading()) {
            <span class="loading loading-spinner"></span>
          }

          <span>
            {{ 'UPLOAD.ACTION.START' | translate }}
          </span>
        </button>
      </div>

      <!-- Status line -->
      <div class="mt-2 text-sm opacity-80">
        @if (!selectedFile() && !uploading() && !doneKey() && !error()) {
          <span>{{ 'UPLOAD.STATUS.NO_FILE' | translate }}</span>
        }

        @if (selectedFile() && !uploading() && !doneKey() && !error()) {
          <span>{{ 'UPLOAD.STATUS.READY' | translate }}</span>
        }

        @if (uploading()) {
          <span>{{ 'UPLOAD.STATUS.UPLOADING' | translate }}</span>
        }
      </div>

      <!-- Progress -->
      @if (progress() > 0 && progress() < 100) {
        <div class="mt-3">
          <progress
            class="progress w-full"
            [value]="progress()"
            max="100">
          </progress>
          <p class="text-xs mt-1">
            {{ 'UPLOAD.PROGRESS.PERCENT' | translate:{ value: progress() } }}
          </p>
        </div>
      }

      <!-- Success -->
      @if (doneKey()) {
        <div role="alert" class="alert alert-success mt-3">
          <div class="flex-1">
            <span class="font-medium">
              {{ 'UPLOAD.SUCCESS.TITLE' | translate }}
            </span>
            <div class="text-xs break-all mt-1">
              {{ 'UPLOAD.SUCCESS.KEY' | translate:{ key: doneKey() } }}
            </div>
          </div>
        </div>
      }

      <!-- Error -->
      @if (error()) {
        <div role="alert" class="alert alert-soft alert-error mt-3">
          <span class="font-bold">
            {{ 'UPLOAD.ERROR.TITLE' | translate }}
          </span>
          <span class="text-xs break-all">
            {{ error() }}
          </span>
        </div>
      }

    </div>
  </div>
</div>
